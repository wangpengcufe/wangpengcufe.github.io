<!DOCTYPE HTML><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta name="baidu-site-verification" content="kZmc8XTvrB"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?458cfc1440d057b6b8799400c6b2e2bf";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><meta charset="utf-8"><title>案例实战：客户价值预测模型 | 机器学习 and 数据科学</title><meta name="author" content="王小鹏  京ICP备19037345号-1"><meta name="keywords" content="机器学习实战，数据挖掘 PDF电子书下载,电子书，PDF下载"><meta name="description" content="PDF电子书下载,电子书，PDF下载"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="案例实战：客户价值预测模型"><meta property="og:site_name" content="机器学习 and 数据科学"><meta property="og:image" content><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="机器学习 and 数据科学" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head><body><header id="header" class="inner"><div class="alignleft"><h1><a href="/">机器学习 and 数据科学</a></h1><h2><a href="/">明天幸福今天修</a></h2></div><nav id="main-nav" class="alignright"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><article id="post-pythonml-pythonml7" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><div class="post-content"><header><div class="icon"></div><time class="dt-published" datetime="2020-07-03T03:10:16.000Z"><a href="/machinelearning/pythonml-pythonml7/">2020-07-03</a><span id="busuanzi_container_page_pv"> &nbsp;&nbsp;&nbsp;&nbsp;阅读 <span id="busuanzi_value_page_pv"></span></span></time><h1 class="p-name title" itemprop="headline name">案例实战：客户价值预测模型</h1></header><div class="e-content entry" itemprop="articleBody"><p><strong>原理：</strong> 利用多元线性回归模型根据多个因素预测客户价值，当模型搭建完成后，就可以对不同价值的客户采用不同的业务策略。</p><p><strong>目录：</strong></p><ul><li>1、案例背景</li><li>2、案例主要应用技术</li><li>3、案例数据</li><li>4、案例过程<ul><li>4.1、导库</li><li>4.2、数据读取</li><li>4.3、数据探索</li><li>4.4、数据预处理<ul><li>4.4.1、重复值处理</li><li>4.4.2、异常值处理</li><li>4.4.3、缺失值处理</li></ul></li><li>4.5、特征工程<ul><li>4.5.1、特征相关性分析</li><li>4.5.2、目标相关性分析</li><li>4.5.3、特征构造</li></ul></li><li>4.6、模型搭建<ul><li>4.6.1、构建特征值和目标值</li><li>4.6.2、划分训练和测试集</li><li>4.6.3、模型搭建</li></ul></li><li>4.7、线性回归方程构造</li><li>4.8、模型评估</li><li>4.9、评估结果解读</li></ul></li><li>5、案例数据结论</li></ul><h2 id="一、案例背景："><a href="#一、案例背景：" class="headerlink" title="一、案例背景："></a><strong>一、案例背景：</strong></h2><p>客户价值预测就是指客户未来一段时间能带来多少利润，其利润的来源可能来自于信用卡的年费、取现手续费、分期手续费、境外交易手续费用等。而分析出客户的价值后，在进行营销、电话接听、催收、产品咨询等各项服务时，就可以针对高价值的客户进行区别于普通客户的服务，有助于进一步挖掘这些高价值客户的价值，并提高这些高价值客户的忠诚度。</p><h2 id="二、案例主要应用技术"><a href="#二、案例主要应用技术" class="headerlink" title="二、案例主要应用技术"></a>二、案例主要应用技术</h2><p>本案例用到的主要技术包括：</p><ul><li>数据建模： 线性回归模型LinearRegression</li><li>模型评估：statsmodels</li><li>模型可视化：matplotlib 、seaborn 画图</li><li>主要用到的库包括：pandas 和 Sklearn</li></ul><p>本案例使用的开发工具是 jupyter notebook，故很多地方直接写对象，就能输出结果，不需要写print()，如果是在其他的编辑器，在输出时，需要加上print()。</p><h2 id="三、案例数据"><a href="#三、案例数据" class="headerlink" title="三、案例数据"></a>三、案例数据</h2><p>以下是数据概览：<br>特征变量数：5<br>数据记录数：128<br>是否有NA值：有<br>是否有异常值：有<br>以下是本数据集的5个特征变量，包括：<br>load_amount : 历史贷款金额，整数型变量。<br>loan_time ：贷款次数，整数型变量。<br>edu：学历，分类型变量， 值域[高中， 本科，研究生]。<br>salary：薪水，整数型变量。<br>sex：性别，值域为男或女。<br>目标变量value :客户价值打分，整数型变量。</p><h2 id="四、案例过程"><a href="#四、案例过程" class="headerlink" title="四、案例过程"></a>四、案例过程</h2><h2 id="4-1、导库"><a href="#4-1、导库" class="headerlink" title="4.1、导库"></a>4.1、导库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd  # pandas库</span><br><span class="line">from sklearn.preprocessing import LabelEncoder # 编号处理</span><br><span class="line">from sklearn.model_selection import train_test_split # 划分训练集和测试集</span><br><span class="line">from sklearn.linear_model import LinearRegression # LinearRegression 线性回归模型</span><br><span class="line">import statsmodels.api as sm  # 模型评估</span><br><span class="line">import matplotlib.pyplot as plt  # 画图</span><br><span class="line">import seaborn as sns  # 画图</span><br><span class="line">plt.rcParams[&quot;font.sans-serif&quot;]=&apos;SimHei&apos; # 中文乱码</span><br><span class="line">plt.rcParams[&apos;axes.unicode_minus&apos;]=False # 负号无法正常显示</span><br><span class="line">%config InlineBackend.figure_format=&apos;svg&apos; # 像素清晰</span><br></pre></td></tr></table></figure><p>pandas：常用的数据读取、 展示、处理和数据保存库。<br>LabelEncoder ：sklearn库中数据预处理的preprocessing 包下的整数编码类，用来将非数值对象转换为数值类型。<br>train_test_split ：sklearn库中用来划分训练集和测试集的类。<br>LinearRegression：sklearn库中linear_model 包下面的线性回归类，用来建立线性回归模型。<br>statsmodels.api ：引入线性回归模型评估相关库。<br>matplotlib.pyplot ：引入matplotlib库进行模型可视化画图。<br>seaborn ：引入seaborn 库进行可视化画图。<br>除了上述库以外，还需要关于使用pandas读Excel需要的附属库。如果之前没有安装过这个库， 需要在系统终端命令行窗口使用pip install xlrd 完成安装。这个库无需导入，在Pandas读取Excel时会自动调用。<br>用pip install xlwt</p><h2 id="4-2、数据读取"><a href="#4-2、数据读取" class="headerlink" title="4.2、数据读取"></a>4.2、数据读取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(&apos;Customer_value.xlsx&apos;)</span><br></pre></td></tr></table></figure><h2 id="4-3、数据探索"><a href="#4-3、数据探索" class="headerlink" title="4.3、数据探索"></a>4.3、数据探索</h2><p><strong>数据形状：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.shape</span><br></pre></td></tr></table></figure><p>打印输出：(128, 6)<br>shape方法用来查看当前数据的形状，返回一个二维的数据元祖，逗号前面的数值表示128行，逗号后面的数值表示6列。</p><p><strong>数据类型：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.info()</span><br></pre></td></tr></table></figure><p>返回结果如下：<br><img src="https://upload-images.jianshu.io/upload_images/7289495-eac04d3c2203a5db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>info方法用来查看数据的类型和缺失情况：</p><ul><li>从整体看，数据总共有128条，范围是[0,127], 总共有6列。从具体字段看，value(客户价值）是整数型，共128条未缺失，缺失值为0。loan_amount(贷款金额）是整数型，共128条未缺失，缺失值为0。loan_time(贷款次数)是整数型，共128条未缺失，缺失值为0。edu(教育程度)是object对象，需要处理成数值，共128条未缺失，缺失值为0。salary (薪水) 是整数型，共126条未缺失，缺失值为2。sex(性别) 是object对象，需要处理成数值，共128条未缺失，缺失值为0。</li><li>统计的结果：总共的类型有 整数型字段4个，object对象2个。</li><li>内存使用情况：6.1kb的内存</li></ul><p><strong>查看前几行：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.head()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200628164457530.png" alt="在这里插入图片描述"><br>head方法用来显示指定数据（N)的前N数据，不指定N的话，默认显示前5条。</p><p><strong>数据概览：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.describe()</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/7289495-85508544d3107013.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>describe方法用来显示数据中所有为数值类型的数据记录数、均值、标准差、最小值、 25%、 50%、75%分位数数据，最大值。</p><h2 id="4-4、数据预处理"><a href="#4-4、数据预处理" class="headerlink" title="4.4、数据预处理"></a>4.4、数据预处理</h2><p>经过数据的探索，我们知道了数据中有缺失值，有非数值对象。这样就需要做2个数据预处理的工作，处理缺失值，和将非数值对象转换为数值对象。在此之前，我们先看看有无重复值。</p><p><strong>4.4.1、重复值处理</strong></p><p>重复数据查询：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[df.duplicated()]</span><br></pre></td></tr></table></figure><p>输出结果：<br><img src="https://img-blog.csdnimg.cn/20200628171106480.png" alt="在这里插入图片描述"><br>duplicated()函数可以查询重复的内容。可以看到第62行记录重复了，被代码筛选了出来。</p><p>查看重复的数量：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.duplicated().sum()</span><br></pre></td></tr></table></figure><p>输出结果为：1。说明数据中只有一行数据重复了。</p><p>删除重复数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = df.drop_duplicates()</span><br></pre></td></tr></table></figure><p>需要注意的是，drop_duplicates()函数并不改变原表格结构，所以需要进行重新赋值，或者在其中设置inplace参数为True。<br>再次查看数据类型：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.info()</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/7289495-f7334d701a83c3b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>可以看到从整体看，数据的数量变成了127行了，比之前的128少了一行，说明重复值删除成功。<br><strong>4.4.2、异常值处理</strong><br>处理完了重复值，我们再来看看数据中有无异常值。<br>查看异常值，我们可以用箱体图进行观察。查看整体的异常情况：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.boxplot()</span><br></pre></td></tr></table></figure><p>输出结果：<br><img src="https://upload-images.jianshu.io/upload_images/7289495-8a018f3676268a89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>可以看到value，loan_amount，loan_time，salary中分别有异常值。不过，异常值是否都直接删除，需要我们结合具体的业务来考虑。value（客户价值）只超过最大值一点，可以不删除。loan_amount(贷款金额）也只比最大值大一点，不是大的很过分，可以考虑不删除，同理，薪水的异常值也可以认为是可接受的范围内。由于load_time(贷款次数）的数据量纲和其他的不一致，我们可以单独查看：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[[&apos;loan_time&apos;]].boxplot()</span><br></pre></td></tr></table></figure><p>输出结果：<br><img src="https://upload-images.jianshu.io/upload_images/7289495-89344d490b226b31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>我们可以看到，有一个贷款次数，是要远远大于其他数据的，结合实际业务情况，我们可以认为这个是异常值，（贷款这么多次，银行的征信还能过得去吗）。当然最保险的做法是和业务人员再进行一次确认，然后进行异常值删除。这里，我们暂且认为这个贷款次数30次的人就是异常值。<br>我们可以找到这条记录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[df[&apos;loan_time&apos;]==30]</span><br></pre></td></tr></table></figure><p>输出结果：<br><img src="https://img-blog.csdnimg.cn/20200628180441327.png" alt="在这里插入图片描述"><br><strong>删除异常值：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = df.drop(df[df[&apos;loan_time&apos;]==30].index)</span><br></pre></td></tr></table></figure><p>查看结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[df[&apos;loan_time&apos;]==30]</span><br></pre></td></tr></table></figure><p>输出结果：<br><img src="https://img-blog.csdnimg.cn/20200628181203856.png" alt="在这里插入图片描述"><br>可以看到数据中已经查不到原来的这条异常记录了。</p><p><strong>4.4.3、缺失值处理</strong></p><p>之所以把缺失值放在异常值处理之后，是因为，缺失值通常用平均值，中位数等方法填补，如果数据中有异常值的话，求平均会影响到缺失值的数值。</p><p>刚才已经通过数据探索，发现了salary(薪水)一列中有缺失值，那么我们可以用代码将其筛选出来：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[df[&apos;salary&apos;].isnull()]</span><br></pre></td></tr></table></figure><p>输出结果：<br><img src="https://img-blog.csdnimg.cn/20200628172240791.png" alt="在这里插入图片描述"><br>可以看到26行和60行的薪水一列是缺失的。<br>缺失值通常处理的方法是删除，平均值填补，中位数填补。根据实际情况，我们这里用平均值法填补。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = df.fillna(df.mean())</span><br></pre></td></tr></table></figure><p>再次确认填补效果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.info()</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/7289495-645ab9c0b874923a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>可以看到，数据中已经没有缺失值了。至此，数据预处理的工作已经做完，下面我们开始特征工程的工作。</p><h2 id="4-5、特征工程"><a href="#4-5、特征工程" class="headerlink" title="4.5、特征工程"></a>4.5、特征工程</h2><p>首先我们查看是否还具有多重共线性的数据，我们查看特征之间的相关性。<br><strong>4.5.1、相关性分析</strong><br>首先获取所有的特征变量：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">feature = df.drop([&apos;value&apos;],axis=1)</span><br><span class="line">feature.head()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629163340287.png" alt="在这里插入图片描述"><br>然后我们查看特征之间的相关性，得到相关性矩阵：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corr = feature.corr()</span><br><span class="line">corr</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629163357799.png" alt="在这里插入图片描述"><br>我们将特征矩阵进行热力图可视化展示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(10,6))</span><br><span class="line">ax = sns.heatmap(corr, xticklabels=corr.columns, yticklabels=corr.columns, </span><br><span class="line">                 linewidths=0.2, cmap=&quot;RdYlGn&quot;,annot=True)</span><br><span class="line">plt.title(&quot;Correlation between variables&quot;)</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/7289495-cd4bc2e20fed136a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>从图中，我们可以看出特征之间没有很强的相关性，没有需要处理的共线性的问题。需要注意的是，特性矩阵只会分析数值类型的特征，不会分析非数值对象的特征。</p><p><strong>4.5.2、目标相关性分析</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_onehot = pd.get_dummies(df)</span><br><span class="line">df_onehot.head()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629163633448.png" alt="在这里插入图片描述"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(15,4))</span><br><span class="line">df_onehot.corr()[&apos;value&apos;].sort_values(ascending=False).plot(kind=&apos;bar&apos;)</span><br><span class="line">plt.title(&apos;Correlation between value  and variables &apos;)</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/7289495-63fcbedc0c3d1087.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>可以看到目标对象value(客户价值）跟贷款金额，薪水，贷款次数高度相关，和性别无关。和学历相关，其中，和本科成正相关，和高中成负相关，跟研究生学历关系不大，这可能是样本中研究生比例小造成的。说明学历对客户价值还是有一定影响的。<br>我们可以看一下样本中学历构成情况：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[&apos;edu&apos;].value_counts()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020062916433731.png" alt="在这里插入图片描述"><br>研究生只有4例。</p><p><strong>4.5.3、特征构造</strong><br>非数值型对象是不能直接进行机器建模学习的，所以我们要处理非数值对象，将其转换为数值对象。这里，我们要用到LabelEncoder函数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">le = LabelEncoder()</span><br><span class="line">edu = le.fit_transform(df[&apos;edu&apos;])</span><br><span class="line">df[&apos;edu&apos;] = edu</span><br><span class="line">sex = le.fit_transform(df[&apos;sex&apos;])</span><br><span class="line">df[&apos;sex&apos;] = sex</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629144634881.png" alt="在这里插入图片描述"><br>通过LabelEncoder函数，我们将原来的数值转换成为了数值，这样就为后面的机器学习建模做好了准备。有的小伙伴会问：那原来edu(学历）中的高中，本科，研究生怎么和数值1,2对应呢？这是个好问题啊，我们可以这样来做。即通过LabelEncoder转换前后的计数我们可以进行比较，具体方法如下：<br>首先我们做一下转换前的计数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[&apos;edu&apos;].value_counts()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629145036599.png" alt="在这里插入图片描述"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[&apos;sex&apos;].value_counts()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629145052883.png" alt="在这里插入图片描述"><br>然后我们做一下转换之后的计数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[&apos;edu&apos;].value_counts()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629145127335.png" alt="在这里插入图片描述"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[&apos;sex&apos;].value_counts()</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629145144273.png" alt="在这里插入图片描述"><br>这样，对应关系就一目了然，不用我再说了吧！</p><h2 id="4-6、模型搭建"><a href="#4-6、模型搭建" class="headerlink" title="4.6、模型搭建"></a>4.6、模型搭建</h2><p><strong>4.6.1、构建特征值和目标值</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 构建特征值X 和目标值 Y</span><br><span class="line">X = df.drop(&apos;value&apos;,axis=1)</span><br><span class="line">y = df[&apos;value&apos;]</span><br></pre></td></tr></table></figure><p>x是包含了除value以外的所有列，y只是value这一列。</p><p><strong>4.6.2、划分训练和测试集</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)</span><br></pre></td></tr></table></figure><p>test_size=0.2,表示用20%的数据测试，用80%的数据来训练。得到的结果为X的训练集X_train, X的测试集X_test, y的训练集 y_train, y的测试集 y_test。</p><p><strong>4.6.3、模型搭建</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">regr = LinearRegression()</span><br><span class="line">regr.fit(X, y)</span><br><span class="line">y_pred = regr.predict(X_test)</span><br></pre></td></tr></table></figure><h2 id="4-7、线性回归方程构造"><a href="#4-7、线性回归方程构造" class="headerlink" title="4.7、线性回归方程构造"></a>4.7、线性回归方程构造</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regr.coef_</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629173734297.png" alt="在这里插入图片描述"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(&apos;各系数为:&apos; + str(regr.coef_))</span><br><span class="line">print(&apos;常数项系数k0为:&apos; + str(regr.intercept_))</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200629173801114.png" alt="在这里插入图片描述"><br>最后得到的线性方程为：y = 129 + 0.059<em>x1 + 95</em>x2 - 53<em>x3 + 0.054</em>x4 + 7.53*x5</p><h2 id="4-8、模型评估"><a href="#4-8、模型评估" class="headerlink" title="4.8、模型评估"></a>4.8、模型评估</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X2 = sm.add_constant(X)</span><br><span class="line">est = sm.OLS(y, X2).fit()</span><br><span class="line">est.summary()</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/7289495-9c0d651071d093f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = len(y_pred)</span><br><span class="line">plt.plot(range(x), y_pred, label=&apos;预测值&apos;)</span><br><span class="line">plt.plot(range(x), y_test, label=&apos;真实值&apos;)</span><br><span class="line">plt.title(&apos;真实值和预测值对比走势图&apos;)</span><br><span class="line">plt.xticks([])</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/7289495-e408a91edbacaf79.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regr.score(X_test, y_test)</span><br></pre></td></tr></table></figure><p>输出结果：准确率为0.6470898016296844</p><h2 id="4-9、评估结果解读"><a href="#4-9、评估结果解读" class="headerlink" title="4.9、评估结果解读"></a>4.9、评估结果解读</h2><p>1、coef列，就是常数项（const）和特征变量（loan_amount, load_time, edu, salary, sex）前的系数，即截距b和斜率系数，可以看到，这和之前求出的结果是一致的。</p><p>2、对模型评估而言，需要关心的几个指标有 R-squared、Adj.R-squared 和P值的信息。</p><p>2.1、这里的R-squared为0.548， Adj.R-squared为0.529，说明模型的线性拟合程度还不是特别好，可能因为案例额数据量偏少，不过在此数据量条件下也算可以接受的结果。</p><p>2.2、对P值而言，大部分的P值都较小，的确与目标变量（客户价值）是显著相关的，而sex这一特征的P值达到了0.819，说明性别和目标变量是没有显著相关性的，这个结论也符合经验认知。之后的建模中就可以舍去这一特征变量了。</p><h2 id="五、案例数据结论"><a href="#五、案例数据结论" class="headerlink" title="五、案例数据结论"></a>五、案例数据结论</h2><p>1、从特征的相关性来看，目标对象value(客户价值）跟贷款金额，薪水，贷款次是呈现高度相关的。这说明用户历史贷款的记录越多，客户的给企业带来了利润，客户的价值自然要高。</p><p>2、客户价值和性别无关。</p><p>3、客户价值和学历相关，其中，和本科成正相关，和高中成负相关，跟研究生学历关系不大，可能学历太低风险性会高一点，客户的价值相对低一点。案例中研究生学历太少，导致结果是跟研究生学历关系不大。</p><p>4、模型的整体准确率只有0.65，R-squared为0.548， Adj.R-squared为0.529，说明模型的拟合程度不是特别满意，可能是案例的数量偏少。不过在此数据量条件下也算可以接受的结果。</p></div><footer><div class="categories"><a href="/categories/machinelearning/">机器学习</a></div><div class="tags"><a href="/tags/content/">content</a>, <a href="/tags/machine-learning/">machine learning</a></div><div class="addthis addthis_toolbox addthis_default_style"><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a> <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a> <a class="addthis_counter addthis_pill_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script><div class="clearfix"></div></footer></div></article><section id="comment"><h1 class="title">留言</h1><div id="fb-root"></div><script>!function(e,t,n){var a,c=e.getElementsByTagName(t)[0];e.getElementById(n)||((a=e.createElement(t)).id=n,a.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345",c.parentNode.insertBefore(a,c))}(document,"script","facebook-jssdk")</script><div class="fb-comments" data-href="http://www.wangpengcufe.com/machinelearning/pythonml-pythonml7/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div></section></div></div><aside id="sidebar" class="alignright"><script language="javascript">function search(e){return e.method="get",e.action="http://www.baidu.com/baidu",document.search_form.word.value=document.search_form.word.value,!0}</script><div class="search"><form name="search_form" target="_blank" onsubmit="search(this)"><input type="search" name="word" results="0" placeholder="百度站内搜索" onblur='this.value=""'></form></div><div class="widget tag"><h3 class="title">分类</h3><ul class="entry"><li><a href="/categories/read/">read</a><small>69</small></li><li><a href="/categories/tools/">工具</a><small>7</small></li><li><a href="/categories/machinelearning/">机器学习</a><small>25</small></li><li><a href="/categories/navigate/">菜单导航</a><small>1</small></li><li><a href="/categories/datadownload/">资料下载</a><small>1</small></li></ul></div><div class="widget tag"><h3 class="title">标签</h3><ul class="entry"><li><a href="/tags/content/">content</a><small>100</small></li><li><a href="/tags/library/">library</a><small>1</small></li><li><a href="/tags/machine-learning/">machine learning</a><small>25</small></li><li><a href="/tags/navigate/">navigate</a><small>1</small></li><li><a href="/tags/tools/">tools</a><small>7</small></li></ul></div><div class="widget tag"><h3 class="title">友情链接</h3><ul class="entry"><li><a href="http://blog.didispace.com" title="程序员DD">程序员DD</a></li><li><a href="https://mangoroom.cn" title="芒果的个人博客">芒果的个人博客</a></li><li><a href="http://www.baimin.com" target="_blank">百鸣网站百科</a></li><li><a href="http://blog.sina.com.cn/u/2435344920" target="_blank">默默读书</a></li><li><a href="https://www.jianshu.com/u/510007ddad06" target="_blank">王小鹏的随笔（简书）</a></li><li><a href="https://me.csdn.net/weixin_42438712" target="_blank">机器学习（csdn博客）</a></li><li><a href="https://zhuanlan.zhihu.com/c_1182309165824901120" target="_blank">机器学习（知乎）</a></li><li><a href="http://meixiaohan.com/" target="_blank">小寒大人的blog</a></li><li><a href="https://baippt.com/" target="_blank">ppt模板免费下载</a></li><li><a href="http://www.youneedcn.com/" target="_blank">你要的资源</a></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2020 王小鹏 京ICP备19037345号-1</div><div class="clearfix"></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></footer><script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">jQuery(".fancybox").fancybox()</script></body></html>