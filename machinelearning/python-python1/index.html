<!DOCTYPE HTML><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta name="baidu-site-verification" content="kZmc8XTvrB"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?458cfc1440d057b6b8799400c6b2e2bf";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><meta charset="utf-8"><title>python数据化运营案例（一） 利用RFM模型做用户价值分析 | 机器学习 and 数据科学</title><meta name="author" content="王小鹏  京ICP备19037345号-1"><meta name="keywords" content="机器学习,特征变换,标签和索引的转化 PDF电子书下载,电子书，PDF下载"><meta name="description" content="PDF电子书下载,电子书，PDF下载"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="python数据化运营案例（一） 利用RFM模型做用户价值分析"><meta property="og:site_name" content="机器学习 and 数据科学"><meta property="og:image" content><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="机器学习 and 数据科学" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head><body><header id="header" class="inner"><div class="alignleft"><h1><a href="/">机器学习 and 数据科学</a></h1><h2><a href="/">明天幸福今天修</a></h2></div><nav id="main-nav" class="alignright"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><article id="post-python-python1" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><div class="post-content"><header><div class="icon"></div><time class="dt-published" datetime="2019-11-25T15:28:56.000Z"><a href="/machinelearning/python-python1/">2019-11-25</a><span id="busuanzi_container_page_pv"> &nbsp;&nbsp;&nbsp;&nbsp;阅读 <span id="busuanzi_value_page_pv"></span></span></time><h1 class="p-name title" itemprop="headline name">python数据化运营案例（一） 利用RFM模型做用户价值分析</h1></header><div class="e-content entry" itemprop="articleBody"><p><img src="http://wangpengcufe.com/ml16.png" alt="卡方选择器"></p><h1 id="一、案例背景"><a href="#一、案例背景" class="headerlink" title="一、案例背景"></a><strong>一、案例背景</strong></h1><p>在产品迭代过程中，通常需要根据用户的属性进行归类，也就是通过分析数据，对用户进行归类，以便于在推送及转化过程中获得更大的收益。</p><p>本案例是基于某互联网公司的实际用户购票数据为研究对象，对用户购票的时间，购买的金额进行了采集，每个用户用手机号来区别唯一性。数据分析人员根据用户购买的时间和金额，通过建立RFM模型，来计算出用户最近最近一次购买的打分，用户购买频率的打分，用户购买金额的打分，然后根据三个分数进行一个加权打分，和综合打分。业务人员可以根据用户的打分情况，对不同的用户进行个性化营销和精准营销，例如给不同的用户推送定制的营销短信，不同优惠额度的打折券等等。</p><p>通过RFM方法，可以根据用户的属性数据分析，对用户进行了归类。在推送、转化等很多过程中，可以更加精准化，不至于出现用户反感的情景，更重要的是，对产品转化等商业价值也有很大的帮助。</p><h1 id="二、RFM概念"><a href="#二、RFM概念" class="headerlink" title="二、RFM概念"></a><strong>二、RFM概念</strong></h1><p><strong>RFM分析</strong> 就是根据客户活跃程度和交易金额的贡献，进行客户价值细分的一种方法。其中：</p><p><strong>R（Recency）</strong>：客户最近一次交易时间的间隔。R值越大，表示客户交易发生的日期越久，反之则表示客户交易发生的日期越近。</p><p><strong>F（Frequency）</strong>：客户在最近一段时间内交易的次数。F值越大，表示客户交易越频繁，反之则表示客户交易不够活跃。<br><strong>M（Monetary）</strong>：客户在最近一段时间内交易的金额。M值越大，表示客户价值越高，反之则表示客户价值越低。</p><p><img src="http://wangpengcufe.com/python1-2.png" alt="客户价值"></p><p><strong>R打分：</strong>基于最近一次交易日期计算的得分，距离当前日期越近，得分越高。例如5分制。<br><strong>F打分：</strong>基于交易频率计算的得分，交易频率越高，得分越高。如5分制。<br><strong>M打分：</strong>基于交易金额计算的得分，交易金额越高，得分越高。如5分制。</p><p><strong>RFM总分值</strong>：RFM=R<em>100+F</em>10+M*1</p><p><strong>RFM分析的主要作用：</strong></p><ul><li><p>识别优质客户。可以指定个性化的沟通和营销服务，为更多的营销决策提供有力支持。</p></li><li><p>能够衡量客户价值和客户利润创收能力。</p></li></ul><h1 id="三、代码实现"><a href="#三、代码实现" class="headerlink" title="三、代码实现"></a><strong>三、代码实现</strong></h1><h3 id="3-1、引包"><a href="#3-1、引包" class="headerlink" title="3.1、引包"></a><strong>3.1、引包</strong></h3><p>首先我们引入需要用的包，数据分析常用的numpy包，pandas包，等。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import numpy as np</span><br><span class="line">import pandas as pd</span><br><span class="line">import mysql.connector</span><br></pre></td></tr></table></figure><h3 id="3-2、读取数据"><a href="#3-2、读取数据" class="headerlink" title="3.2、读取数据"></a><strong>3.2、读取数据</strong></h3><p>接下来我们开始用pd.read_csv方法读取用户的数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dtypes = &#123;&apos;ORDERDATE&apos;:object, &apos;ORDERID&apos;:object, &apos;AMOUNTINFO&apos;:np.float32&#125;  #每列数据类型</span><br><span class="line">raw_data = pd.read_csv(&apos;../data/sales.csv&apos;, dtype=dtypes, index_col = &apos;USERID&apos;) #读取数据文件</span><br></pre></td></tr></table></figure><p>其中，dtypes里的参数指定了没一列的字段类型，购票时间（ORDERDATE)，订单号（ORDERID）都是object类型，订单金额（AMOUNTINFO）是浮点类型。index_col指定了数据中用户的唯一性用 USERID来表示。</p><h3 id="3-3、数据审查"><a href="#3-3、数据审查" class="headerlink" title="3.3、数据审查"></a><strong>3.3、数据审查</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(&apos;Data Overview :&apos;)</span><br><span class="line">print(raw_data.head(4)) #打印原始数据前4条</span><br><span class="line">print(&apos;-&apos; * 30)</span><br><span class="line">print(&apos;Data DESC:&apos;)</span><br><span class="line">print(raw_data.describe())  #打印原始数据基本描述性信息</span><br></pre></td></tr></table></figure><p>用raw_data.head(n)来指定取出数据的前几条，’-‘*30是用来输出打印分隔线，下文再出现时不再重复解释，用raw_data.describe()来获得数据的基本描述性信息。输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Data Overview:</span><br><span class="line">                      ORDERDATE               ORDERNO  PAYAMOUNT</span><br><span class="line">PHONENO                                                         </span><br><span class="line">135****0930 2019-10-02 13:37:36  01201910021336227979        7.0</span><br><span class="line">183****1153 2019-09-30 06:22:29  0120190930062149F9AF        4.5</span><br><span class="line">150****6073 2019-10-30 18:21:45  01201910301821065CFD        2.0</span><br><span class="line">173****7295 2019-10-21 15:13:23  01201910211512498153        7.0</span><br><span class="line">------------------------------</span><br><span class="line">Data DESC:</span><br><span class="line">          PAYAMOUNT</span><br><span class="line">count  96323.000000</span><br><span class="line">mean       4.212409</span><br><span class="line">std        3.049499</span><br><span class="line">min        0.000000</span><br><span class="line">25%        2.600000</span><br><span class="line">50%        3.600000</span><br><span class="line">75%        5.000000</span><br><span class="line">max       80.000000</span><br></pre></td></tr></table></figure><p>结果中的 count表示总共的记录条数，mean表示了均值，std表示标准差，min表示最小值，25%表示下四分位，也叫第一四分位，50%表示中位值，也叫第二四分位，75%表示上四分位，也叫第三四分位。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">na_cols = raw_data.isnull().any(axis=0) #查看每一列是否具有缺失值</span><br><span class="line">print(&apos;NA Cols:&apos;)</span><br><span class="line">print(na_cols)</span><br><span class="line">print(&apos;-&apos; * 30)</span><br><span class="line">na_lines = raw_data.isnull().any(axis=1) #查看每一行是否具有缺失值</span><br><span class="line">print(&apos;NA Records:&apos;)</span><br><span class="line">print(&apos;Total number of NA lines is :&#123;0&#125;&apos;.format(na_lines.sum()))  #查看具有缺失值的行总记录数</span><br><span class="line">print(raw_data[na_lines])  #只查看具有缺失值的行信息</span><br><span class="line">print(&apos;-&apos; * 60)</span><br></pre></td></tr></table></figure><p>用raw_data.isnull()来判断是否有缺失值，其中参数axis=0表示的是列，axis=1表示的是行，用:{0}’.format()的方式在字符串中传入参数。输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NA Cols:</span><br><span class="line">ORDERDATE    False</span><br><span class="line">ORDERNO      False</span><br><span class="line">PAYAMOUNT    False</span><br><span class="line">dtype: bool</span><br><span class="line">------------------------------</span><br><span class="line">NA Records:</span><br><span class="line">Total number of NA lines is :0</span><br><span class="line">Empty DataFrame</span><br><span class="line">Columns: [ORDERDATE, ORDERNO, PAYAMOUNT]</span><br><span class="line">Index: []</span><br><span class="line">------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>可以看出，实际的交易用户数据还是比较完整的，没有缺失数据的情况，可能这批数据被技术人员采集过来已经处理过了，不讨论了。如果数据有缺失的情况怎么办？那么就要对缺失的数据进行一个预处理。</p><h3 id="3-4、数据预处理"><a href="#3-4、数据预处理" class="headerlink" title="3.4、数据预处理"></a><strong>3.4、数据预处理</strong></h3><p>数据预处理，包括数据异常，格式转换，单位转化（如果有单位不统一的情况）等。<br><strong>异常值处理</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sales_data = raw_data.dropna() #丢弃带有缺失值的行记录</span><br><span class="line">sales_data = sales_data[sales_data[&apos;PAYAMOUNT&apos;] &gt; 1]</span><br></pre></td></tr></table></figure><p>这里，我用代码去除了小于1元的订单，正常出行连1块钱都不用，那应该是测试数据了，现在谁出门做个公交还不得1元起步。对于用户有缺失值的记录进行了丢弃，当然也可以用其他的方法，例如平均值补全法。<br><strong>日期格式转换</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sales_data[&apos;ORDERDATE&apos;] = pd.to_datetime(sales_data[&apos;ORDERDATE&apos;])</span><br><span class="line">print(&apos;Raw Dtype:&apos;)</span><br><span class="line">print(sales_data.dtypes)</span><br><span class="line">print(&apos;-&apos;*60)</span><br></pre></td></tr></table></figure><p>用pd.to_datetime()方法对用户的订单日期进行了格式化转换。输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Raw Dtype:</span><br><span class="line">ORDERDATE    datetime64[ns]</span><br><span class="line">ORDERNO              object</span><br><span class="line">PAYAMOUNT           float64</span><br><span class="line">dtype: object</span><br><span class="line">------------------------------------------------------------</span><br></pre></td></tr></table></figure><p><strong>数据转换</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">recency_value = sales_data[&apos;ORDERDATE&apos;].groupby(sales_data.index).max()  #计算原始最近一次购买时间</span><br><span class="line">frequency_value = sales_data[&apos;ORDERDATE&apos;].groupby(sales_data.index).count()    #计算原始订单数</span><br><span class="line">monetray_value = sales_data[&apos;PAYAMOUNT&apos;].groupby(sales_data.index).sum()  #计算原始订单总金额</span><br></pre></td></tr></table></figure><p>这里根据订单日期的聚合运算得到了用户的最近一次购买时间，用户总的购买数，和购买金额，max()得到了购买时间，count()得到了购买数量，sum()得到了购买金额。</p><h3 id="3-5、计算RFM得分"><a href="#3-5、计算RFM得分" class="headerlink" title="3.5、计算RFM得分"></a><strong>3.5、计算RFM得分</strong></h3><p>得到了最近的购买时间，购买数，和购买金额，下面就可以开始计算RFM得分了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deadline_date = pd.datetime(2019,10,11)</span><br><span class="line">r_interval = (deadline_date - recency_value).dt.days</span><br><span class="line">r_score = pd.cut(r_interval,5,labels=[5,4,3,2,1])</span><br><span class="line">f_score = pd.cut(frequency_value,5,labels=[1,2,3,4,5])</span><br><span class="line">m_score = pd.cut(monetray_value,5,labels=[1,2,3,4,5])</span><br></pre></td></tr></table></figure><p>用deadline_date来表示分析的截止日期，那么统计用户的时间范围就是从数据中最早开始的购买时间到deadline_date。<br>用pandas.series.dt.days可以对操作后的datatime直接进行取数。pandas.cut用来把一组数据分割成离散的区间。<br>简单介绍一下pandas.cut的用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pandas.cut(x, bins, right=True, labels=None, retbins=False, precision=3, include_lowest=False, duplicates=&apos;raise&apos;)</span><br></pre></td></tr></table></figure><ul><li><strong>x</strong>：被切分的类数组（array-like）数据，必须是1维的（不能用DataFrame）；</li><li><strong>bins</strong>：bins是被切割后的区间（或者叫“桶”、“箱”、“面元”），有3中形式：一个int型的标量、标量序列（数组）或者pandas.IntervalIndex 。<ul><li><strong>一个int型的标量</strong>，当bins为一个int型的标量时，代表将x平分成bins份。x的范围在每侧扩展0.1%，以包括x的最大值和最小值。</li><li>标量序列，标量序列定义了被分割后每一个bin的区间边缘，此时x没有扩展。</li><li>pandas.IntervalIndex，定义要使用的精确区间。</li></ul></li><li>right：bool型参数，默认为True，表示是否包含区间右部。比如如果bins=[1,2,3]，right=True，则区间为(1,2]，(2,3]；right=False，则区间为(1,2),(2,3)。</li><li><strong>labels</strong>：给分割后的bins打标签，比如把年龄x分割成年龄段bins后，可以给年龄段打上诸如青年、中年的标签。labels的长度必须和划分后的区间长度相等，比如bins=[1,2,3]，划分后有2个区间(1,2]，(2,3]，则labels的长度必须为2。如果指定labels=False，则返回x中的数据在第几个bin中（从0开始）。</li><li>retbins：bool型的参数，表示是否将分割后的bins返回，当bins为一个int型的标量时比较有用，这样可以得到划分后的区间，默认为False。</li><li>precision：保留区间小数点的位数，默认为3.</li><li>include_lowest：bool型的参数，表示区间的左边是开还是闭的，默认为false，也就是不包含区间左部（闭）。</li><li>duplicates：是否允许重复区间。有两种选择：raise：不允许，drop：允许。</li></ul><p>重点理解我标粗的几个参数，其他参数有需要用到时查阅。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><footer><div class="categories"><a href="/categories/machinelearning/">机器学习</a></div><div class="tags"><a href="/tags/machine-learning/">machine learning</a>, <a href="/tags/content/">content</a></div><div class="addthis addthis_toolbox addthis_default_style"><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a> <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a> <a class="addthis_counter addthis_pill_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script><div class="clearfix"></div></footer></div></article><section id="comment"><h1 class="title">留言</h1><div id="fb-root"></div><script>!function(e,t,n){var a,c=e.getElementsByTagName(t)[0];e.getElementById(n)||((a=e.createElement(t)).id=n,a.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345",c.parentNode.insertBefore(a,c))}(document,"script","facebook-jssdk")</script><div class="fb-comments" data-href="http://www.wangpengcufe.com/machinelearning/python-python1/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div></section></div></div><aside id="sidebar" class="alignright"><script language="javascript">function search(e){return e.method="get",e.action="http://www.baidu.com/baidu",document.search_form.word.value=document.search_form.word.value,!0}</script><div class="search"><form name="search_form" target="_blank" onsubmit="search(this)"><input type="search" name="word" results="0" placeholder="百度站内搜索" onblur='this.value=""'></form></div><div class="widget tag"><h3 class="title">分类</h3><ul class="entry"><li><a href="/categories/read/">read</a><small>63</small></li><li><a href="/categories/tools/">工具</a><small>2</small></li><li><a href="/categories/machinelearning/">机器学习</a><small>17</small></li><li><a href="/categories/navigate/">菜单导航</a><small>1</small></li><li><a href="/categories/datadownload/">资料下载</a><small>1</small></li></ul></div><div class="widget tag"><h3 class="title">标签</h3><ul class="entry"><li><a href="/tags/content/">content</a><small>81</small></li><li><a href="/tags/library/">library</a><small>1</small></li><li><a href="/tags/machine-learning/">machine learning</a><small>17</small></li><li><a href="/tags/navigate/">navigate</a><small>1</small></li><li><a href="/tags/tools/">tools</a><small>2</small></li></ul></div><div class="widget tag"><h3 class="title">友情链接</h3><ul class="entry"><li><a href="http://blog.didispace.com" title="程序员DD">程序员DD</a></li><li><a href="https://mangoroom.cn" title="芒果的个人博客">芒果的个人博客</a></li><li><a href="http://www.baimin.com" target="_blank">百鸣网站百科</a></li><li><a href="http://blog.sina.com.cn/u/2435344920" target="_blank">默默读书</a></li><li><a href="https://www.jianshu.com/u/510007ddad06" target="_blank">王小鹏的随笔（简书）</a></li><li><a href="https://me.csdn.net/weixin_42438712" target="_blank">机器学习（csdn博客）</a></li><li><a href="https://zhuanlan.zhihu.com/c_1182309165824901120" target="_blank">机器学习（知乎）</a></li><li><a href="http://meixiaohan.com/" target="_blank">小寒大人的blog</a></li><li><a href="https://baippt.com/" target="_blank">ppt模板免费下载</a></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2019 王小鹏 京ICP备19037345号-1</div><div class="clearfix"></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></footer><script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">jQuery(".fancybox").fancybox()</script></body></html>